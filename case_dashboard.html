<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Sarabun", sans-serif;
      background-color: #f7f9fb;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #1b365d;
      text-align: center;
      margin-bottom: 25px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
      gap: 15px;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
      border-left: 5px solid; 
    }
    /* ‡∏™‡∏µ Border ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
    #totalCasesCard { border-color: #1b365d; }
    #firstCourtCasesCard { border-color: #2196F3; }
    #supremeCourtCasesCard { border-color: #FFC107; }
    #finalJudgementCasesCard { border-color: #4CAF50; }
    #enforcementInProgressCasesCard { border-color: #FF9800; }
    #enforcementCompleteCasesCard { border-color: #009688; }


    .card h3 {
      font-size: 0.9em;
      margin: 5px 0 0;
      color: #1b365d;
    }
    .card h2 {
      font-size: 1.8em;
      margin: 5px 0;
      color: #1b365d;
    }
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }
    h2 {
      color: #1b365d;
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #1b365d;
      color: white;
      font-weight: 700;
    }
    tbody tr:hover {
        background-color: #f0f4f8;
    }
  </style>
</head>
<body>
  <h1>üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h1>

  <div class="dashboard">
    <div class="card" id="totalCasesCard">
      <h3>‡∏Ñ‡∏î‡∏µ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <h2 id="totalCases">-</h2>
    </div>
    <div class="card" id="firstCourtCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏®‡∏≤‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô)</h3>
      <h2 id="firstCourtCases">-</h2>
    </div>
    <div class="card" id="supremeCourtCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏®‡∏≤‡∏•‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</h3>
      <h2 id="supremeCourtCases">-</h2>
    </div>
    <div class="card" id="finalJudgementCasesCard">
      <h3>‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</h3>
      <h2 id="finalJudgementCases">-</h2>
    </div>
    <div class="card" id="enforcementInProgressCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ</h3>
      <h2 id="enforcementInProgressCases">-</h2>
    </div>
    <div class="card" id="enforcementCompleteCasesCard">
      <h3>‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h3>
      <h2 id="enforcementCompleteCases">-</h2>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="caseStatusChart"></canvas>
  </div>

  <h2>üìÅ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (10 ‡∏Ñ‡∏î‡∏µ)</h2>
  <table id="casesTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥</th>
        <th>‡∏®‡∏≤‡∏•</th>
        <th>‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // **********************************************
    // ‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‚ö†Ô∏è
    // **********************************************
    // 1. **YOUR_SHEET_ID**: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á Google Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì 
    //    (‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á /d/ ‡πÅ‡∏•‡∏∞ /edit ‡πÉ‡∏ô URL ‡∏Ç‡∏≠‡∏á Sheet)
    const sheetId = "1xkexhCplurn2koS1Gj8ahzpFs2wRfIWUFbFypmGcm3g"; 
    
    // 2. **YOUR_API_KEY**: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Google Cloud API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    //    (‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
    const apiKey = "YOUR_API_KEY"; 
    
    // 3. **Range**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á (‡πÄ‡∏ä‡πà‡∏ô A1 ‡∏ñ‡∏∂‡∏á M100)
    const range = "A1:M100";
    
    // 4. ‡∏ä‡∏∑‡πà‡∏≠ Sheet: ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠ Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 'Sheet1' ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    const sheetName = "Sheet1"; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ä‡∏∑‡πà‡∏≠ Sheet ‡∏Ñ‡∏∑‡∏≠ Sheet1
    
    // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Google Sheets API
    const sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${apiKey}`;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const calculateCaseSummary = (cases) => {
        const statusMap = {
            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
            firstCourtCases: (status) => status && status.includes("‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô") && !status.includes("‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î") && !status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"),
            supremeCourtCases: (status) => status && status.includes("‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î") && !status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"),
            finalJudgementCases: (status) => status && status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î") && !status.includes("‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ"),
            enforcementInProgressCases: (status) => status && status.includes("‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ") && !status.includes("‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"),
            enforcementCompleteCases: (status) => status && status.includes("‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
        };

        const summary = { totalCases: cases.length };

        for (const key in statusMap) {
            // ‡πÉ‡∏ä‡πâ toUpperCase() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Sheet ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
            summary[key] = cases.filter(c => statusMap[key](c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"] ? c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].toUpperCase() : "")).length;
        }

        return summary;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dashboard (KPI Cards)
    const updateDashboard = (summary) => {
        document.getElementById("totalCases").innerText = summary.totalCases;
        document.getElementById("firstCourtCases").innerText = summary.firstCourtCases;
        document.getElementById("supremeCourtCases").innerText = summary.supremeCourtCases;
        document.getElementById("finalJudgementCases").innerText = summary.finalJudgementCases;
        document.getElementById("enforcementInProgressCases").innerText = summary.enforcementInProgressCases;
        document.getElementById("enforcementCompleteCases").innerText = summary.enforcementCompleteCases;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    const renderChart = (summary) => {
        const ctx = document.getElementById("caseStatusChart");
        const chartData = {
          labels: ["‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô)", "‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)", "‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß", "‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ", "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"],
          datasets: [{
            label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ",
            data: [
              summary.firstCourtCases, 
              summary.supremeCourtCases, 
              summary.finalJudgementCases, 
              summary.enforcementInProgressCases, 
              summary.enforcementCompleteCases
            ],
            backgroundColor: ["#2196F3", "#FFC107", "#4CAF50", "#FF9800", "#009688"]
          }]
        };
        
        if (window.caseStatusChart) {
            window.caseStatusChart.destroy(); 
        }

        window.caseStatusChart = new Chart(ctx, {
          type: "bar",
          data: chartData,
          options: { 
            responsive: true, 
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
          }
        });
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    fetch(sheetUrl)
      .then(res => {
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        return res.json();
      })
      .then(data => {
        const rows = data.values;
        if (!rows || rows.length < 2 || !rows[0].includes("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ")) {
            console.error("Data error: Missing rows or '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ' header.");
            updateDashboard({ totalCases: 0, firstCourtCases: 0, supremeCourtCases: 0, finalJudgementCases: 0, enforcementInProgressCases: 0, enforcementCompleteCases: 0 });
            renderChart({ firstCourtCases: 0, supremeCourtCases: 0, finalJudgementCases: 0, enforcementInProgressCases: 0, enforcementCompleteCases: 0 });
            return;
        }

        const headers = rows[0];
        const cases = rows.slice(1).map(r => Object.fromEntries(headers.map((h, i) => [h, r[i]])));
        
        const caseSummary = calculateCaseSummary(cases);
        
        updateDashboard(caseSummary);
        renderChart(caseSummary);

        // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        const tbody = document.querySelector("#casesTable tbody");
        tbody.innerHTML = "";
        cases.slice(-10).reverse().forEach(c => {
          const row = `<tr>
            <td>${c["‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥"] || "-"}</td>
            <td>${c["‡∏®‡∏≤‡∏•"] || "-"}</td>
            <td>${c["‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
            <td>${c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
          </tr>`;
          tbody.insertAdjacentHTML("beforeend", row);
        });
      })
      .catch(err => {
          console.error("Error fetching or processing data:", err);
          alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${err.message}\n‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 1. API Key 2. Sheet ID 3. ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Sheet`);
      });
  </script>
</body>
</html>