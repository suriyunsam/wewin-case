<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #1b365d;
      --secondary-color: #007bff;
      --background-color: #f7f9fb;
      --card-bg: #fff;
    }

    body {
      font-family: "Sarabun", sans-serif;
      background-color: var(--background-color);
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
      font-weight: 600;
    }

    /* Dashboard cards */
    .dashboard {
      display: grid;
      /* ‚úÖ DESKTOP (3x2): ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      text-align: center;
      transition: transform 0.2s;
    }

    .card:hover { transform: translateY(-4px); }
    .card h2 { color: var(--primary-color); font-size: 1rem; margin-bottom: 10px; }
    .card p { font-size: 2rem; font-weight: 700; color: var(--secondary-color); margin: 0; }

    /* Color by type */
    .card-total p { color: #5cb85c; }
    .card-first p { color: #2196f3; }
    .card-final p { color: #4caf50; }
    .card-supreme p { color: #ffc107; }
    .card-enforcement p { color: #ff8c00; }
    .card-complete p { color: #008080; }

    /* Layout */
    .content-area {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
    }

    /* ‚úÖ MOBILE (2x3): ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏Ñ‡∏ö‡∏•‡∏á */
    @media (max-width: 900px) { 
        .content-area { 
            grid-template-columns: 1fr; /* Content area ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        } 
        
        .dashboard {
            grid-template-columns: repeat(2, 1fr); /* Dashboard ‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        }
    }

    /* MOBILE (1x6): ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏Ñ‡∏ö‡∏°‡∏≤‡∏Å ‡πÜ */
    @media (max-width: 550px) {
        .dashboard {
            grid-template-columns: 1fr; /* Dashboard ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        }
    }
    
    .chart-container, .table-container {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }

    .chart-container h2, .table-container h2 {
      color: var(--primary-color);
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
      font-size: 1.3rem;
      margin-top: 0;
    }

    #loadingMessage {
      text-align: center;
      color: var(--primary-color);
      font-weight: 600;
      margin-top: 40px;
    }

    /* Search bar */
    .search-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .search-bar input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }

    /* Table */
    .table-container { overflow-x: auto; }

    table {
      width: 100%;
      min-width: 700px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    th {
      background: #f0f4f8;
      color: var(--primary-color);
      font-weight: 600;
      white-space: nowrap;
    }

    tr:hover { background-color: #f5f5f5; }
  </style>
</head>

<body>
  <h1>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</h1>

  <div id="loadingMessage">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <div class="dashboard" id="mainDashboard" style="display:none;">
    <div class="card card-total"><h2>‡∏Ñ‡∏î‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2><p id="totalCases">0</p></div>
    <div class="card card-first"><h2>‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≠‡∏á‡∏®‡∏≤‡∏•‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô</h2><p id="firstCourtCases">0</p></div>
    <div class="card card-final"><h2>‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h2><p id="finalCases">0</p></div>
    <div class="card card-supreme"><h2>‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≠‡∏á‡∏®‡∏≤‡∏•‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h2><p id="supremeCourtCases">0</p></div>
    <div class="card card-enforcement"><h2>‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ</h2><p id="inExecutionCases">0</p></div>
    <div class="card card-complete"><h2>‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h2><p id="executionCompleteCases">0</p></div>
  </div>

  <div class="content-area" id="mainContent" style="display:none;">
    <div class="chart-container">
      <h2>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <canvas id="caseStatusChart" width="400" height="400"></canvas>
    </div>

    <div class="table-container">
      <h2 id="tableTitle">10 ‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
      <div class="search-bar">
        <label for="caseSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥:</label>
        <input type="text" id="caseSearch" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥..." />
      </div>
      <table>
        <thead>
          <tr>
            <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥</th>
            <th>‡∏õ‡∏µ‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥</th>
            <th>‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ</th>
            <th>‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ</th>
          </tr>
        </thead>
        <tbody id="casesTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_URL = `https://wewin-case-api.onrender.com/api/casestatus`;

    const el = {
      loading: document.getElementById("loadingMessage"),
      dashboard: document.getElementById("mainDashboard"),
      content: document.getElementById("mainContent"),
      tableBody: document.getElementById("casesTableBody"),
      tableTitle: document.getElementById("tableTitle"),
      search: document.getElementById("caseSearch"),
    };

    let allCases = [];

    // üîπ ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô Object
    const arrayToObjects = (data) => {
      const headers = data[0];
      return data.slice(1).map((row) => {
        const obj = {};
        headers.forEach((h, i) => (obj[h] = row[i] || ""));
        return obj;
      });
    };

    // üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function renderTable(cases) {
      el.tableBody.innerHTML = "";
      if (cases.length === 0) {
        el.tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        return;
      }
      cases.forEach((c) => {
        el.tableBody.insertAdjacentHTML(
          "beforeend",
          `<tr>
            <td>${c["‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥"] || "-"}</td>
            <td>${c["‡∏õ‡∏µ‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥"] || "-"}</td>
            <td>${c["‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
            <td>${c["‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤"] || "-"}</td>
            <td>${c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
          </tr>`
        );
      });
    }

    // üîπ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function filterCases() {
      const term = el.search.value.trim();
      let filtered = [];
      if (term === "") {
        // ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        filtered = allCases.slice(-10).reverse();
        el.tableTitle.innerText = "10 ‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î";
      } else {
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥
        filtered = allCases.filter((c) =>
          (c["‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥"] || "").toString().includes(term)
        );
        el.tableTitle.innerText = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${term}"`;
      }
      renderTable(filtered);
    }

    el.search.addEventListener("input", filterCases);

    // üîπ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
    async function loadData() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        if (!json.values) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï");

        allCases = arrayToObjects(json.values);

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const total = allCases.length;
        const first = allCases.filter((x) => x["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].includes("‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô")).length;
        const supreme = allCases.filter((x) => x["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].includes("‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î")).length;
        const final = allCases.filter((x) => x["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î")).length;
        const exec = allCases.filter((x) => x["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].includes("‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ")).length;
        const done = allCases.filter((x) => x["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].includes("‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")).length;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô Dashboard
        document.getElementById("totalCases").innerText = total;
        document.getElementById("firstCourtCases").innerText = first;
        document.getElementById("supremeCourtCases").innerText = supreme;
        document.getElementById("finalCases").innerText = final;
        document.getElementById("inExecutionCases").innerText = exec;
        document.getElementById("executionCompleteCases").innerText = done;

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏ß‡∏á‡∏Å‡∏•‡∏°
        const ctx = document.getElementById("caseStatusChart").getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: [
              "‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
              "‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô",
              "‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î",
              "‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ",
              "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô",
            ],
            datasets: [
              {
                data: [final, first, supreme, exec, done],
                backgroundColor: ["#4caf50", "#2196f3", "#ffc107", "#ff8c00", "#008080"],
              },
            ],
          },
          options: { plugins: { legend: { position: "right" } } },
        });

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á Dashboard/Content
        el.loading.style.display = "none";
        el.dashboard.style.display = "grid";
        el.content.style.display = "grid";
        filterCases();
      } catch (err) {
        console.error(err);
        el.loading.innerText = `‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${err.message}`;
        el.loading.style.color = "red";
      }
    }

    loadData();
  </script>
</body>
</html>