<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Sarabun", sans-serif;
      background-color: #f7f9fb;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #1b365d;
      text-align: center;
      margin-bottom: 25px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
      gap: 15px;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
      border-left: 5px solid; 
    }
    /* ‡∏™‡∏µ Border ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
    #totalCasesCard { border-color: #1b365d; }
    #firstCourtCasesCard { border-color: #2196F3; }
    #supremeCourtCasesCard { border-color: #FFC107; }
    #finalJudgementCasesCard { border-color: #4CAF50; }
    #enforcementInProgressCasesCard { border-color: #FF9800; }
    #enforcementCompleteCasesCard { border-color: #009688; }

    .card h3 {
      font-size: 0.9em;
      margin: 5px 0 0;
      color: #1b365d;
    }
    .card h2 {
      font-size: 1.8em;
      margin: 5px 0;
      color: #1b365d;
    }
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }
    h2 {
      color: #1b365d;
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #1b365d;
      color: white;
      font-weight: 700;
    }
    tbody tr:hover {
        background-color: #f0f4f8;
    }
    .error-box {
        background-color: #fee2e2;
        color: #b91c1c;
        border: 1px solid #fca5a5;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h1>
  <div id="statusMessage"></div> <!-- ‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î -->

  <div class="dashboard">
    <div class="card" id="totalCasesCard">
      <h3>‡∏Ñ‡∏î‡∏µ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <h2 id="totalCases">-</h2>
    </div>
    <div class="card" id="firstCourtCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏®‡∏≤‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô)</h3>
      <h2 id="firstCourtCases">-</h2>
    </div>
    <div class="card" id="supremeCourtCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏®‡∏≤‡∏•‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</h3>
      <h2 id="supremeCourtCases">-</h2>
    </div>
    <div class="card" id="finalJudgementCasesCard">
      <h3>‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</h3>
      <h2 id="finalJudgementCases">-</h2>
    </div>
    <div class="card" id="enforcementInProgressCasesCard">
      <h3>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ</h3>
      <h2 id="enforcementInProgressCases">-</h2>
    </div>
    <div class="card" id="enforcementCompleteCasesCard">
      <h3>‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h3>
      <h2 id="enforcementCompleteCases">-</h2>
    </div>
  </div>

  <div class="chart-container">
    <canvas id="caseStatusChart"></canvas>
  </div>

  <h2>üìÅ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (10 ‡∏Ñ‡∏î‡∏µ)</h2>
  <table id="casesTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥</th>
        <th>‡∏®‡∏≤‡∏•</th>
        <th>‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // **********************************************
    // ‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‚ö†Ô∏è
    // **********************************************
    // 1. **SHEET ID**: ID ‡∏Ç‡∏≠‡∏á Google Sheet
    const sheetId = "1xkexhCplurn2koS1Gj8ahzpFs2wRfIWUFbFypmGcm3g"; 
    
    // 2. **API KEY**: Google Cloud API Key
    const apiKey = "AIzaSyCPsgQyhXD28bNQOu-sKPaXxzdoPlyTXHw"; // 
    
    // 3. **Range**: ‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const range = "A1:M100";
    
    // 4. ‡∏ä‡∏∑‡πà‡∏≠ Sheet: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 'Sheet1' ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
    const sheetName = "Sheet1"; 

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ö‡∏ô UI
    const displayError = (message) => {
        document.getElementById("statusMessage").innerHTML = `<div class="error-box">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${message}</div>`;
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
        document.getElementById("totalCases").innerText = "Error";
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Placeholder ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
    if (apiKey === "YOUR_API_KEY") {
        displayError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 'YOUR_API_KEY' ‡∏î‡πâ‡∏ß‡∏¢ API Key ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
    } else {
        fetchDataAndRenderDashboard();
    }

    const sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${apiKey}`;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    function fetchDataAndRenderDashboard() {
        console.log("Attempting to fetch data from URL:", sheetUrl);

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const calculateCaseSummary = (cases) => {
            const statusMap = {
                firstCourtCases: (status) => status && status.includes("‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô") && !status.includes("‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î") && !status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"),
                supremeCourtCases: (status) => status && status.includes("‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î") && !status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"),
                finalJudgementCases: (status) => status && status.includes("‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î") && !status.includes("‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ"),
                enforcementInProgressCases: (status) => status && status.includes("‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ") && !status.includes("‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"),
                enforcementCompleteCases: (status) => status && status.includes("‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
            };

            const summary = { totalCases: cases.length };

            for (const key in statusMap) {
                summary[key] = cases.filter(c => statusMap[key](c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"] ? c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"].toUpperCase() : "")).length;
            }
            return summary;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dashboard (KPI Cards)
        const updateDashboard = (summary) => {
            document.getElementById("totalCases").innerText = summary.totalCases;
            document.getElementById("firstCourtCases").innerText = summary.firstCourtCases;
            document.getElementById("supremeCourtCases").innerText = summary.supremeCourtCases;
            document.getElementById("finalJudgementCases").innerText = summary.finalJudgementCases;
            document.getElementById("enforcementInProgressCases").innerText = summary.enforcementInProgressCases;
            document.getElementById("enforcementCompleteCases").innerText = summary.enforcementCompleteCases;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü
        const renderChart = (summary) => {
            const ctx = document.getElementById("caseStatusChart");
            const chartData = {
              labels: ["‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏ä‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô)", "‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)", "‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß", "‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ", "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"],
              datasets: [{
                label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ",
                data: [
                  summary.firstCourtCases, 
                  summary.supremeCourtCases, 
                  summary.finalJudgementCases, 
                  summary.enforcementInProgressCases, 
                  summary.enforcementCompleteCases
                ],
                backgroundColor: ["#2196F3", "#FFC107", "#4CAF50", "#FF9800", "#009688"]
              }]
            };
            
            if (window.caseStatusChart) {
                window.caseStatusChart.destroy(); 
            }

            window.caseStatusChart = new Chart(ctx, {
              type: "bar",
              data: chartData,
              options: { 
                responsive: true, 
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
              }
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        fetch(sheetUrl)
          .then(res => {
            if (!res.ok) {
                // ‡∏ñ‡πâ‡∏≤ HTTP status ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 200 (OK) ‡πÉ‡∏´‡πâ throw error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà .catch()
                throw new Error(`HTTP Error Status: ${res.status}. Check API Key and Sheet Sharing Permissions.`);
            }
            return res.json();
          })
          .then(data => {
            const rows = data.values;
            if (!rows || rows.length < 2 || !rows[0].includes("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ")) {
                displayError("‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ('‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ' ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å)");
                return;
            }

            const headers = rows[0];
            const cases = rows.slice(1).map(r => Object.fromEntries(headers.map((h, i) => [h, r[i]])));
            
            const caseSummary = calculateCaseSummary(cases);
            
            updateDashboard(caseSummary);
            renderChart(caseSummary);

            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const tbody = document.querySelector("#casesTable tbody");
            tbody.innerHTML = "";
            cases.slice(-10).reverse().forEach(c => {
              const row = `<tr>
                <td>${c["‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏î‡∏µ‡∏î‡∏≥"] || "-"}</td>
                <td>${c["‡∏®‡∏≤‡∏•"] || "-"}</td>
                <td>${c["‡∏ú‡∏π‡πâ‡∏ü‡πâ‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
                <td>${c["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏î‡∏µ"] || "-"}</td>
              </tr>`;
              tbody.insertAdjacentHTML("beforeend", row);
            });
          })
          .catch(err => {
              console.error("Fetch Data Failed:", err);
              displayError(`‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${err.message}. ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console Log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (F12)`);
          });
    }
  </script>
</body>
</html>
